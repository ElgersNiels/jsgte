<!doctype html>
<html class="no-js" lang"">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>2 by 2 games</title>
        <link rel="stylesheet" href="css/2by2.css">
    </head>
</script>

<body onload="initDraws()">
        <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

<script>
    var svg;
    var ctx1,ctx2;
    var points=[];
    var svgH=400;
    var svgW=300;
    var moving_point;
    var payoff=[];
    

    
    function initDraws() {
        svg = document.getElementById("SVG");
        svgPosition = svg.getBoundingClientRect();
        payoff=document.getElementsByClassName("pay");
        for(i=0;i<8;i++){
          payoff[i].addEventListener("mousedown", doMouseDown);
        }
        compute_firstP();
        compute_secondP();
        draw();
    }


function redraw(){
    compute_firstP();
    compute_secondP();
    draw();
}

function getMousePosition(e) {
    return {
        x: e.clientX ,
        y: e.clientY
  };
}


function doMouseDown(event) {
    event.preventDefault();
    //var temp=this.parentNode.childNodes[13];
    //this.parentNode.insertBefore(this,null);
    moving_point=this;
    document.addEventListener("mousemove", doMouseMove);
    this.addEventListener("mouseup", doMouseUp);
    this.removeEventListener("mousedown", doMouseDown);
    console.log("Down: "+this.getAttribute("id"));
}


function doMouseUp(event) {
    mousePosition = getMousePosition(event)
    document.removeEventListener("mousemove", doMouseMove);
    moving_point=null;
    this.addEventListener("mousedown", doMouseDown);
    console.log("Releasing: X = " + mousePosition.x + ", Y = " + mousePosition.y);
}


function doMouseMove(event) {
    var mousePosition = getMousePosition(event)
    svgPosition = moving_point.parentNode.getBoundingClientRect();
    var newPos=~~((-mousePosition.y+svgPosition.top+svgH-50)/3)/10;
    if (Number(newPos)<0) newPos=0;
    if (Number(newPos)>10) newPos=10;
    if( (Number(newPos)-moving_point.getAttribute("cy"))*(Number(newPos)-moving_point.getAttribute("cy"))>0.005){
       document.getElementById(moving_point.getAttribute("asso")).value=newPos;
       redraw();
    }
    
    //console.log("Moving: X = " + mousePosition.x + ", Y = " + mousePosition.y);
}



function compute_firstP(){
        var P1_11=document.getElementById("P1_11").value;
        var P1_12=document.getElementById("P1_12").value;
        var P1_21=document.getElementById("P1_21").value;
        var P1_22=document.getElementById("P1_22").value;
        payoff[0].setAttributeNS(null, "cy", svgH-50-P1_11*30);
        payoff[1].setAttributeNS(null, "cy", svgH-50-P1_12*30);
        payoff[2].setAttributeNS(null, "cy", svgH-50-P1_21*30);
        payoff[3].setAttributeNS(null, "cy", svgH-50-P1_22*30);
        var maxP1_1, minP1_1, maxP1_2, minP1_2; // max and min off player1 payoff for strategy 1 or 2 of player2
        if( Number(P1_11)>Number(P1_21)){
            maxP1_1=P1_11;
            minP1_1=P1_21;
        }else{
            maxP1_1=P1_21;
            minP1_1=P1_11;
        }
        if( Number(P1_12)>Number(P1_22)){
            maxP1_2=P1_12;
            minP1_2=P1_22;
        }else{
            maxP1_2=P1_22;
            minP1_2=P1_12;
        }
        if((maxP1_1==P1_11 && maxP1_2==P1_12)||(maxP1_1==P1_21 && maxP1_2==P1_22)){
            point1_1={x:50,y:svgH-50-maxP1_1*30};
            point1_2={x:svgW-50,y:svgH-50-maxP1_2*30};
            point1_3={x:svgW-50,y:svgH-50-maxP1_2*30};}
        else{
            var middle_x=(P1_21-P1_11)/(Number(P1_21)- Number(P1_22) + Number(P1_12) - Number(P1_11));
            var middle_y=Number((P1_12-P1_11)*middle_x)+Number(P1_11);
            point1_1={x:50, y:svgH-50-maxP1_1*30};
            point1_2={x:middle_x * (svgW-100)+50,y:svgH-50-middle_y*30};
            point1_3={x:svgW-50,y:svgH-50-maxP1_2*30};
        }
    }
            
    function compute_secondP(){
        var P2_11=document.getElementById("P2_11").value;
        var P2_12=document.getElementById("P2_12").value;
        var P2_21=document.getElementById("P2_21").value;
        var P2_22=document.getElementById("P2_22").value;
        
        payoff[4].setAttributeNS(null, "cy", svgH-50-P2_11*30);
        payoff[5].setAttributeNS(null, "cy", svgH-50-P2_12*30);
        payoff[6].setAttributeNS(null, "cy", svgH-50-P2_21*30);
        payoff[7].setAttributeNS(null, "cy", svgH-50-P2_22*30);
        var maxP2_1, minP2_1, maxP2_2, minP2_2; // max and min off player1 payoff for strategy 1 or 2 of player2
        if( Number(P2_11)>Number(P2_12)){
            maxP2_1=P2_11;
            minP2_1=P2_12;
        }else{
            maxP2_1=P2_12;
            minP2_1=P2_11;
        }
        if( Number(P2_21)>Number(P2_22)){
            maxP2_2=P2_21;
            minP2_2=P2_22;
        }else{
            maxP2_2=P2_22;
            minP2_2=P2_21;
        }
        if((maxP2_1==P2_11 && maxP2_2==P2_21)||(maxP2_1==P2_12 && maxP2_2==P2_22)){
            point2_1={x:450,y:svgH-50-maxP2_1*30};
            point2_2={x:svgW-50+400,y:svgH-50-maxP2_2*30};
            point2_3={x:svgW-50+400,y:svgH-50-maxP2_2*30};
            }
        else{
            var middle_x=(P2_12-P2_11)/(Number(P2_12)- Number(P2_22) + Number(P2_21) - Number(P2_11));
            var middle_y=Number((P2_21-P2_11)*middle_x)+Number(P2_11);
            point2_1={x:450,y:svgH-50-maxP2_1*30};
            point2_2={x:middle_x * (svgW-100)+450,y:svgH-50-middle_y*30};
            point2_3={x:svgW-50+400,y:svgH-50-maxP2_2*30};
        }
    }
    
    function draw(){
        var P1S1=document.getElementById("P1S1").value;
        var P1S2=document.getElementById("P1S2").value;
        var P2S1=document.getElementById("P2S1").value;
        var P2S2=document.getElementById("P2S2").value;
        // Lines update svg1
        var lines=svg.getElementsByTagName("line");
        lines[0].setAttributeNS(null, "y1", payoff[0].getAttribute("cy"));
        lines[0].setAttributeNS(null, "y2", payoff[1].getAttribute("cy"));
        var labelline=svg.getElementById("text11");
        labelline.setAttributeNS(null, "y", payoff[0].getAttribute("cy"));
        labelline.textContent=P1S1;
        lines[1].setAttributeNS(null, "y1", payoff[2].getAttribute("cy"));
        lines[1].setAttributeNS(null, "y2", payoff[3].getAttribute("cy"));
        labelline=svg.getElementById("text12");
        labelline.setAttributeNS(null, "y", payoff[3].getAttribute("cy"));
        labelline.textContent=P1S2;
        // Lines update svg2
        lines[lines.length/2+0].setAttributeNS(null, "y1", payoff[4].getAttribute("cy"));
        lines[lines.length/2+0].setAttributeNS(null, "y2", payoff[6].getAttribute("cy"));
        labelline=svg.getElementById("text21");
        labelline.setAttributeNS(null, "y", payoff[4].getAttribute("cy"));
        labelline.textContent=P2S1;
        lines[lines.length/2+1].setAttributeNS(null, "y1", payoff[5].getAttribute("cy"));
        lines[lines.length/2+1].setAttributeNS(null, "y2", payoff[7].getAttribute("cy"));
        labelline=svg.getElementById("text22");
        labelline.setAttributeNS(null, "y", payoff[7].getAttribute("cy"));
        labelline.textContent=P2S2;
        //envelop svg1
        var envelop1=document.getElementById("envelop1");
        envelop1.setAttributeNS(null,"points", "50,50 "+point1_1.x+","+point1_1.y+" "+point1_2.x+","+point1_2.y+" "+point1_3.x+","+point1_3.y+" 250,50");
        var inter=svg.getElementById("inter1");
        inter.setAttributeNS(null,"cx", point1_2.x);
        inter.setAttributeNS(null,"cy", point1_2.y);
        var interlabel=svg.getElementById("interlabel1");
        interlabel.setAttributeNS(null, "x",point1_2.x);
        interlabel.textContent=~~((Number(point1_2.x)-50)/2)/100;
        var stick=svg.getElementById("interstick1");
        stick.setAttributeNS(null, "x1",point1_2.x);
        stick.setAttributeNS(null, "x2",point1_2.x);
        //envelop svg2
        var envelop2=document.getElementById("envelop2");
        envelop2.setAttributeNS(null,"points", "450,50 "+point2_1.x+","+point2_1.y+" "+point2_2.x+","+point2_2.y+" "+point2_3.x+","+point2_3.y+" 650,50");
        inter=svg.getElementById("inter2");
        inter.setAttributeNS(null,"cx", point2_2.x);
        inter.setAttributeNS(null,"cy", point2_2.y);
        interlabel=svg.getElementById("interlabel2");
        interlabel.setAttributeNS(null, "x",point2_2.x);
        interlabel.textContent=~~((Number(point2_2.x)-450)/2)/100;
        stick=svg.getElementById("interstick2");
        stick.setAttributeNS(null, "x1",point2_2.x);
        stick.setAttributeNS(null, "x2",point2_2.x);
        
        //change legend according to strategies name.
        var temp= svg.getElementById("y11");
        temp.textContent=P2S1;
        temp= svg.getElementById("y12");
        temp.textContent=P2S2;
        temp= svg.getElementById("y21");
        temp.textContent=P1S1;
        temp= svg.getElementById("y22");
        temp.textContent=P1S2;
        temp= svg.getElementById("prob2");
        temp.textContent="Player2 "+P2S2+" prob";
        temp= svg.getElementById("prob1");
        temp.textContent="Player1 "+P1S2+" prob";
    }

</script>
 <!-- Table for user to update payoff and strategies' names.-->
        <table border="1">
  <tr>
    <th><label class="player1">Player I</label> \ <label class="player2">Player II</label></th>
    <th><label><input class="player2 strat1" type="text" id="P2S1" onchange="redraw()" value="S1"/> </label></th>
    <th><label><input class="player2 strat2" type="text" id="P2S2" onchange="redraw()" value="S2"/> </label></th>
  </tr>
  <tr>
      <th><label><input class="player1 strat1" type="text" id="P1S1" onchange="redraw()" value="S1"/> </label></th>
    <td><input class="player1 payoff" type="text" id="P1_11" onchange="redraw()" value=0>\<input class="player2 payoff" type="text" id="P2_11"  onchange="redraw()" value=0></td>
    <td><input class="player1 payoff" type="text" id="P1_12" onchange="redraw()" value=0>\<input class="player2 payoff" type="text" id="P2_12" onchange="redraw()" value=0></td>
  </tr>
  <tr>
  <th><label><input class="player1 strat2" type="text" id="P1S2" onchange="redraw()" value="S2"/> </label></th>
    <td><input class="player1 payoff" type="text" id="P1_21" onchange="redraw()" value=0>\<input class="player2 payoff" type="text" id="P2_21"  onchange="redraw()" value=0></td>
    <td><input class="player1 payoff" type="text" id="P1_22" onchange="redraw()" value=0>\<input class="player2 payoff" type="text" id="P2_22"  onchange="redraw()" value=0></td>
  </tr>
</table>
        
        <svg id="SVG" version="1.1" viewBox="0 0 700 400">
            <!-- Drawing the contour-->
            <polyline points="50,50 50,350 250,350, 250,50"/>
            <!-- Legend, strategy names will be updated after-->
            <text class="player1 title" x="150" y="40">Player1 payoff</text>
            <text class="player2 legendh" id="prob2" x="150" y="390">Player2 S2 prob</text>
            <text class="player2 legendv" id="y11" x="20" y="200" transform="rotate(270 20,200)">S1</text>
            <text class="player2 legendv" id="y12" x="280" y="200" transform="rotate(90 280,200)">S2</text>
            <text class="player2 legendh" x="40" y="370">0</text>
            <text class="player2 legendh" x="250" y="370">1</text>
            <!-- Upper envelop, coordinates will be updated-->
            <polygon id="envelop1" points="50,50 50,350 250,350 250,50"/>
            <!-- First strategy payoff-->
            <line class="line1" id="11" x1="50" y1="350" x2="250" y2="350" />
            <text id="text11" class="player1 legendh" x="80" y="350">S1</text>
            <!-- Second strategy payoff-->
            <line class="line1" id="12" x1="50" y1="350" x2="250" y2="350"/>
            <text id="text12" class="player1 legendh" x="200" y="350">S2</text>
            <!-- Sticks-->
            <line class="stick" x1="50" y1="80" x2="45" y2="80"/>
            <text class="sticklabel" x="35" y="85">9</text>
            <line class="stick" x1="50" y1="110" x2="45" y2="110"/>
            <text class="sticklabel" x="35" y="115">8</text>
            <line class="stick" x1="50" y1="140" x2="45" y2="140"/>
            <text class="sticklabel" x="35" y="145">7</text>
            <line class="stick" x1="50" y1="170" x2="45" y2="170"/>
            <text class="sticklabel" x="35" y="175">6</text>
            <line class="stick" x1="50" y1="200" x2="45" y2="200"/>
            <text class="sticklabel" x="35" y="205">5</text>
            <line class="stick" x1="50" y1="230" x2="45" y2="230"/>
            <text class="sticklabel" x="35" y="235">4</text>
            <line class="stick" x1="50" y1="260" x2="45" y2="260"/>
            <text class="sticklabel" x="35" y="265">3</text>
            <line class="stick" x1="50" y1="290" x2="45" y2="290"/>
            <text class="sticklabel" x="35" y="295">2</text>
            <line class="stick" x1="50" y1="320" x2="45" y2="320"/>
            <text class="sticklabel" x="35" y="325">1</text>
            <line class="stick" x1="250" y1="80" x2="255" y2="80"/>
            <text class="sticklabel" x="258" y="85">9</text>
            <line class="stick" x1="250" y1="110" x2="255" y2="110"/>
            <text class="sticklabel" x="258" y="115">8</text>
            <line class="stick" x1="250" y1="140" x2="255" y2="140"/>
            <text class="sticklabel" x="258" y="145">7</text>
            <line class="stick" x1="250" y1="170" x2="255" y2="170"/>
            <text class="sticklabel" x="258" y="175">6</text>
            <line class="stick" x1="250" y1="200" x2="255" y2="200"/>
            <text class="sticklabel" x="258" y="205">5</text>
            <line class="stick" x1="250" y1="230" x2="255" y2="230"/>
            <text class="sticklabel" x="258" y="235">4</text>
            <line class="stick" x1="250" y1="260" x2="255" y2="260"/>
            <text class="sticklabel" x="258" y="265">3</text>
            <line class="stick" x1="250" y1="290" x2="255" y2="290"/>
            <text class="sticklabel" x="258" y="295">2</text>
            <line class="stick" x1="250" y1="320" x2="255" y2="320"/>
            <text class="sticklabel" x="258" y="325">1</text>
            <!-- Intersection point-->
            <circle class="inter" id="inter1" cx="250" cy="350" r="5" draggable="false" ondragstart="doMouseDown()"/>
            <line class="line2" id="interstick1" x1="250" y1="350" x2="250" y2="355"/>
            <text class="player2 legendh" id="interlabel1" x="250" y="370">1</text>
            <!-- Payoff points-->
            <circle class="pay line1" id="Payoff1_11" asso="P1_11" cx="50" cy="350" r="5" draggable="false" ondragstart="doMouseDown()"/>
            <circle class="pay line1" id="Payoff1_12" asso="P1_12" cx="250" cy="350" r="5"  draggable="false" ondragstart="doMouseDown()"/>
            <circle class="pay line1" id="Payoff1_21" asso="P1_21" cx="50" cy="350" r="5"  draggable="false" ondragstart="doMouseDown()"/>
            <circle class="pay line1" id="Payoff1_22" asso="P1_22" cx="250" cy="350" r="5" draggable="false" ondragstart="doMouseDown()"/>

            <!-- Drawing the contour-->
            <polyline points="450,50 450,350 650,350, 650,50"/>
            <!-- Legend, strategy names will be updated after-->
            <text class="player2 title" x="550" y="40">Player2 payoff</text>
            <text class="player1 legendh" id="prob1" x="550" y="390">Player1 S2 prob</text>
            <text class="player1 legendh" x="440" y="370">0</text>
            <text class="player1 legendh" x="650" y="379">1</text>
            <text class="player1 legendv" id="y21" x="420" y="200"transform="rotate(270 420,200)">S1</text>
            <text class="player1 legendv" id="y22" x="680" y="200"transform="rotate(90 680,200)">S2</text>
            <!-- Upper envelop, coordinates will be updated-->
            <polygon id="envelop2" points="450,50 450,350 450,350 450,50"/>
            <!-- First strategy payoff-->
            <line class="line2" id="21" x1="450" y1="350" x2="650" y2="350"/>
            <text id="text21" class="player2 legendh" x="480" y="350">S1</text>
            <!-- Second strategy payoff-->
            <line class="line2" id="22" x1="450" y1="350" x2="650" y2="350"/>
            <text id="text22" class="player2 legendh" x="600" y="350">S2</text>
            <!-- Sticks-->
            <line class="stick" x1="450" y1="80" x2="445" y2="80"/>
            <text class="sticklabel" x="435" y="85">9</text>
            <line class="stick" x1="450" y1="110" x2="445" y2="110"/>
            <text class="sticklabel" x="435" y="115">8</text>
            <line class="stick" x1="450" y1="140" x2="445" y2="140"/>
            <text class="sticklabel" x="435" y="145">7</text>
            <line class="stick" x1="450" y1="170" x2="445" y2="170"/>
            <text class="sticklabel" x="435" y="175">6</text>
            <line class="stick" x1="450" y1="200" x2="445" y2="200"/>
            <text class="sticklabel" x="435" y="205">5</text>
            <line class="stick" x1="450" y1="230" x2="445" y2="230"/>
            <text class="sticklabel" x="435" y="235">4</text>
            <line class="stick" x1="450" y1="260" x2="445" y2="260"/>
            <text class="sticklabel" x="435" y="265">3</text>
            <line class="stick" x1="450" y1="290" x2="445" y2="290"/>
            <text class="sticklabel" x="435" y="295">2</text>
            <line class="stick" x1="450" y1="320" x2="445" y2="320"/>
            <text class="sticklabel" x="435" y="325">1</text>
            <line class="stick" x1="650" y1="80" x2="655" y2="80"/>
            <text class="sticklabel" x="658" y="85">9</text>
            <line class="stick" x1="650" y1="110" x2="655" y2="110"/>
            <text class="sticklabel" x="658" y="115">8</text>
            <line class="stick" x1="650" y1="140" x2="655" y2="140"/>
            <text class="sticklabel" x="658" y="145">7</text>
            <line class="stick" x1="650" y1="170" x2="655" y2="170"/>
            <text class="sticklabel" x="658" y="175">6</text>
            <line class="stick" x1="650" y1="200" x2="655" y2="200"/>
            <text class="sticklabel" x="658" y="205">5</text>
            <line class="stick" x1="650" y1="230" x2="655" y2="230"/>
            <text class="sticklabel" x="658" y="235">4</text>
            <line class="stick" x1="650" y1="260" x2="655" y2="260"/>
            <text class="sticklabel" x="658" y="265">3</text>
            <line class="stick" x1="650" y1="290" x2="655" y2="290"/>
            <text class="sticklabel" x="658" y="295">2</text>
            <line class="stick" x1="650" y1="320" x2="655" y2="320"/>
            <text class="sticklabel" x="658" y="325">1</text>
            <!-- Intersection point-->
            <circle class="inter" id="inter2" cx="650" cy="350" r="5" draggable="false" ondragstart="doMouseDown()"/>
            <line class="line1" id="interstick2" x1="650" y1="350" x2="650" y2="355"/>
            <text class="player1 legendh" id="interlabel2" x="650" y="370">1</text>
            <!-- Payoff points-->
            <circle class="pay line2" id="Payoff2_11" asso="P2_11" cx="450" cy="350" r="5"  draggable="false" ondragstart="doMouseDown()"/>
            <circle class="pay line2" id="Payoff2_12" asso="P2_12" cx="450" cy="350" r="5"  draggable="false" ondragstart="doMouseDown()"/>
            <circle class="pay line2" id="Payoff2_21" asso="P2_21" cx="650" cy="350" r="5" draggable="false" ondragstart="doMouseDown()"/>
            <circle class="pay line2" id="Payoff2_22" asso="P2_22" cx="650" cy="350" r="5" draggable="false" ondragstart="doMouseDown()"/>
            
        </svg>
        
                                                                    
</body>
</html>
